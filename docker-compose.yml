services:
  mysql:
    image: mysql:8.0
    container_name: naago-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: naago
      MYSQL_USER: naago
      MYSQL_PASSWORD: Naago123456
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
    command: --default-authentication-plugin=mysql_native_password
    healthcheck:
      test: [
        "CMD",
        "mysqladmin",
        "ping",
        "-h",
        "localhost",
        "-u",
        "root",
        "-prootpassword",
      ]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - naago-network

  phpmyadmin:
    image: phpmyadmin:latest
    container_name: naago-phpmyadmin
    restart: unless-stopped
    depends_on:
      mysql:
        condition: service_healthy
    environment:
      PMA_HOST: mysql
      PMA_PORT: 3306
      PMA_USER: naago
      PMA_PASSWORD: Naago123456
      MYSQL_ROOT_PASSWORD: rootpassword
    ports:
      - "8080:80"
    networks:
      - naago-network

  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: naago-app
    restart: unless-stopped
    depends_on:
      mysql:
        condition: service_healthy
    volumes:
      - ./images:/app/images:ro
      - ./themes:/app/themes:ro
    environment:
      # Discord
      - DISCORD_CLIENT_ID=922673201476153354
      - DISCORD_GUILD_ID=848133842024005662
      - DISCORD_TOKEN=OTIyNjczMjAxNDc2MTUzMzU0.G1q8QW.Q9B5fVpeIr4QkHG9ZFrrjxRnqKy1-2YzdeHlAA
      - IS_PROD=false
      - LODESTONE_CHECK_ON_START=false
      - CHECK_COMMAND_IDS=false
      # Database
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_USER=naago
      - DB_PASS=Naago123456
      - DB_DATABASE=naago
      # Naagostone API
      - NAAGOSTONE_HOST=host.docker.internal
      - NAAGOSTONE_PORT=3001
      - SAVE_LODESTONE_NEWS=true
      - SEND_LODESTONE_NEWS=true
      # Twitter
      - TWITTER_BEARER_TOKEN=YOUR_TWITTER_BEARER_TOKEN
      - TWITTER_USERNAME=kaiyokostar
      # UI Colors
      - COLOR_GREEN=#43b581
      - COLOR_RED=#f04747
      - COLOR_BLURPLE=#5865F2
      - COLOR_TOPICS=#3498db
      - COLOR_NOTICES=#f1c40f
      - COLOR_MAINTENANCES=#e74c3c
      - COLOR_UPDATES=#2ecc71
      - COLOR_STATUS=#e67e22
      - COLOR_TWITTER=#1DA1F2
      # Icon Links
      - ICON_TOPICS=https://lds-img.finalfantasyxiv.com/h/W/_v7zlp4yma56rKwd8pIzU8wGFc.png
      - ICON_NOTICES=https://lds-img.finalfantasyxiv.com/h/c/GK5Y3gQsnlxMRQ_pORu6lKQAJ0.png
      - ICON_MAINTENANCES=https://lds-img.finalfantasyxiv.com/h/U/6qzbI-6AwlXAfGhCBZU10jsoLA.png
      - ICON_UPDATES=https://lds-img.finalfantasyxiv.com/h/a/dFnS0OBVXIsmB74L65R7VHlpd8.png
      - ICON_STATUS=https://img.finalfantasyxiv.com/lds/h/L/sEOasqXJx6MHgRHlQHSJHU_SVI.png
      - ICON_LODESTONE=https://img.finalfantasyxiv.com/lds/h/g/F7AqWSRkzqF2OMtj_0-UNS4WoA.png
      - ICON_TWITTER=https://abs.twimg.com/icons/apple-touch-icon-192x192.png
      # Profile Settings
      - PROFILE_WIDTH=800
      - PROFILE_HEIGHT=600
      - PROFILE_BORDER_RADIUS=10
      - PROFILE_BORDER_RADIUS_OUTER=15
      # Game Constants
      - MAX_LEVEL=100
      - MAX_LEVEL_LIMITED=80
      - MAX_MOUNTS=900
      - MAX_MINIONS=800
      - MAX_ACHIEVEMENTS=4000
    networks:
      - naago-network
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  mysql_data:
    driver: local

networks:
  naago-network:
    driver: bridge
